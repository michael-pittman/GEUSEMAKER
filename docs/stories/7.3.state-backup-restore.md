# Story 7.3: State Backup and Restore

## Status
Done

## Story

**As a** developer managing deployments,
**I want** backup and restore capabilities for deployment state,
**so that** I can recover from state corruption or accidental deletion.

## Acceptance Criteria

1. Automatic backups created before state modifications
2. Manual backup creation via `geusemaker backup <name>`
3. Backup listing shows available backups with timestamps
4. Restore from backup via `geusemaker restore <name> --backup <timestamp>`
5. Backup retention policy (keep last N backups)
6. Backup includes all deployment metadata
7. Restore validates backup integrity before applying
8. Backup storage location is configurable
9. Unit tests achieve 80%+ coverage

## Tasks / Subtasks

- [x] Task 1: Implement Auto-Backup (AC: 1)
  - [x] Create backup before each state save
  - [x] Store in ~/.geusemaker/backups/
  - [x] Use timestamp in backup filename
  - [x] Compress backups (gzip)

- [x] Task 2: Implement Manual Backup (AC: 2)
  - [x] Create backup command
  - [x] Allow custom backup name
  - [x] Display backup location

- [x] Task 3: Implement Backup Listing (AC: 3)
  - [x] Add `geusemaker backup list <name>` command
  - [x] Show timestamp, size, version
  - [x] Sort by date (newest first)

- [x] Task 4: Implement Restore (AC: 4, 7)
  - [x] Add `geusemaker restore` command
  - [x] Validate backup before restore
  - [x] Create backup of current before restore
  - [x] Apply restored state

- [x] Task 5: Implement Retention Policy (AC: 5)
  - [x] Configure max backups (default: 10)
  - [x] Delete oldest when limit exceeded
  - [x] Support `--keep-all` flag

- [x] Task 6: Implement Configuration (AC: 8)
  - [x] Support custom backup directory
  - [x] Support S3 backup location (future)
  - [x] Store config in ~/.geusemaker/config

- [x] Task 7: Create Unit Tests (AC: 9)
  - [x] Test auto-backup creation
  - [x] Test manual backup
  - [x] Test restore functionality
  - [x] Test retention policy
  - [x] Achieve 80%+ coverage

## Dev Notes

### File Locations
```
geusemaker/
├── services/
│   └── backup/
│       ├── __init__.py
│       └── service.py
├── cli/
│   └── commands/
│       ├── backup.py
│       └── restore.py
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-21 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
