# Story 10.2: IAM Roles and Access Control

## Status
Draft

## Story

**As a** security administrator,
**I want** deployments to use proper IAM roles,
**so that** services have only necessary AWS permissions.

## Acceptance Criteria

1. EC2 instances use IAM instance profiles (not credentials)
2. IAM roles follow least privilege principle
3. Role policies are documented and auditable
4. Custom IAM roles can be specified
5. Permissions boundaries are supported
6. IAM policy validation before deployment
7. Credential exposure is prevented
8. Role assumption is logged
9. Unit tests achieve 80%+ coverage

## Tasks / Subtasks

- [ ] Task 1: Create Instance Profile (AC: 1)
  - [ ] Create IAM role for EC2
  - [ ] Create instance profile
  - [ ] Attach to EC2 instances

- [ ] Task 2: Define Minimal Permissions (AC: 2)
  - [ ] Define EFS access permissions
  - [ ] Define CloudWatch permissions
  - [ ] No other permissions by default

- [ ] Task 3: Document Policies (AC: 3)
  - [ ] Document each permission
  - [ ] Explain why needed
  - [ ] Show policy JSON

- [ ] Task 4: Support Custom Roles (AC: 4)
  - [ ] Accept --iam-role parameter
  - [ ] Validate role exists
  - [ ] Use custom role instead

- [ ] Task 5: Support Permissions Boundaries (AC: 5)
  - [ ] Accept --permissions-boundary
  - [ ] Apply to created roles
  - [ ] Validate boundary exists

- [ ] Task 6: Validate Permissions (AC: 6)
  - [ ] Use IAM policy simulator
  - [ ] Check required actions
  - [ ] Report insufficient permissions

- [ ] Task 7: Prevent Credential Exposure (AC: 7)
  - [ ] Never log credentials
  - [ ] Never store in state
  - [ ] Use instance metadata

- [ ] Task 8: Create Unit Tests (AC: 9)
  - [ ] Test role creation
  - [ ] Test policy validation
  - [ ] Test custom role support
  - [ ] Achieve 80%+ coverage

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-21 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
